<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:MoleculeEfficienceTracker"
    xmlns:chart="clr-namespace:Syncfusion.Maui.Charts;assembly=Syncfusion.Maui.Charts"
    x:Class="MoleculeEfficienceTracker.ChargePage"
    Title="Charge">
    <ContentPage.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/ModernStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <Color x:Key="MainBgColor">#F0F4F8</Color>
        </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Background>
        <SolidColorBrush Color="{StaticResource MainBgColor}"/>
    </ContentPage.Background>

    <ScrollView>
        <VerticalStackLayout Style="{StaticResource PageRootLayoutStyle}"
                             BackgroundColor="{StaticResource MainBgColor}">
            <Label Text="ðŸ“Š Moyennes journaliÃ¨res"
                   FontAttributes="Bold"
                   FontSize="24"
                   TextColor="{StaticResource Primary}"/>

            <!-- Bloc 24h -->
            <Frame Style="{StaticResource CardFrameStyle}">
                <VerticalStackLayout Spacing="6">
                    <Label Text="â±ï¸ DerniÃ¨res 24h"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"/>
                    <CollectionView x:Name="StatsCollection1d"
                                    ItemsSource="{Binding Stats1d}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="12"
                                       Padding="8"
                                       Margin="0,2"
                                       BackgroundColor="White"
                                       HasShadow="True">
                                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" RowDefinitions="Auto,Auto"
                                          ColumnSpacing="10"
                                          RowSpacing="4"
                                          VerticalOptions="Center">
                                        <Label Grid.Row="0" Grid.Column="0"
                                               Text="{Binding Icon}"
                                               FontSize="18"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Row="0" Grid.Column="1"
                                               Text="{Binding MoleculeName}"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Row="0" Grid.Column="2"
                                               Text="{Binding AvgDose, StringFormat='{0:F1} mg'}"
                                               HorizontalOptions="End"
                                               FontAttributes="Bold"/>
                                        <Label Grid.Row="0" Grid.Column="3"
                                               Text="{Binding VariationText}"
                                               TextColor="{Binding VariationColor}"
                                               HorizontalOptions="End"
                                               FontAttributes="Bold"/>
                                        <ProgressBar Grid.Row="1" Grid.ColumnSpan="4"
                                                     Progress="{Binding ProgressRatio}"
                                                     ProgressColor="{Binding ProgressColor}"
                                                     BackgroundColor="#E5E7EB"
                                                     HeightRequest="6"
                                                     Margin="0,4,0,0"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Bloc 7 jours -->
            <Frame Style="{StaticResource CardFrameStyle}">
                <VerticalStackLayout Spacing="6">
                    <Label Text="ðŸ“… 7 derniers jours"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"/>
                    <CollectionView x:Name="StatsCollection7d"
                                    ItemsSource="{Binding Stats7d}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="12"
                                       Padding="8"
                                       Margin="0,2"
                                       BackgroundColor="White"
                                       HasShadow="True">
                                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" RowDefinitions="Auto,Auto"
                                          ColumnSpacing="10"
                                          RowSpacing="4"
                                          VerticalOptions="Center">
                                        <Label Grid.Row="0" Grid.Column="0"
                                               Text="{Binding Icon}"
                                               FontSize="18"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Row="0" Grid.Column="1"
                                               Text="{Binding MoleculeName}"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Row="0" Grid.Column="2"
                                               Text="{Binding AvgDose, StringFormat='{0:F1} mg'}"
                                               HorizontalOptions="End"
                                               FontAttributes="Bold"/>
                                        <Label Grid.Row="0" Grid.Column="3"
                                               Text="{Binding VariationText}"
                                               TextColor="{Binding VariationColor}"
                                               HorizontalOptions="End"
                                               FontAttributes="Bold"/>
                                        <ProgressBar Grid.Row="1" Grid.ColumnSpan="4"
                                                     Progress="{Binding ProgressRatio}"
                                                     ProgressColor="{Binding ProgressColor}"
                                                     BackgroundColor="#E5E7EB"
                                                     HeightRequest="6"
                                                     Margin="0,4,0,0"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Bloc 30 jours -->
            <Frame Style="{StaticResource CardFrameStyle}">
                <VerticalStackLayout Spacing="6">
                    <Label Text="ðŸ—“ï¸ 30 derniers jours"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"/>
                    <CollectionView x:Name="StatsCollection30d"
                                    ItemsSource="{Binding Stats30d}"
                                    SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="12"
                                       Padding="8"
                                       Margin="0,2"
                                       BackgroundColor="White"
                                       HasShadow="True">
                                    <Grid ColumnDefinitions="Auto,*,Auto,Auto" RowDefinitions="Auto,Auto"
                                          ColumnSpacing="10"
                                          RowSpacing="4"
                                          VerticalOptions="Center">
                                        <Label Grid.Row="0" Grid.Column="0"
                                               Text="{Binding Icon}"
                                               FontSize="18"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Row="0" Grid.Column="1"
                                               Text="{Binding MoleculeName}"
                                               FontAttributes="Bold"
                                               VerticalOptions="Center"/>
                                        <Label Grid.Row="0" Grid.Column="2"
                                               Text="{Binding AvgDose, StringFormat='{0:F1} mg'}"
                                               HorizontalOptions="End"
                                               FontAttributes="Bold"/>
                                        <Label Grid.Row="0" Grid.Column="3"
                                               Text="{Binding VariationText}"
                                               TextColor="{Binding VariationColor}"
                                               HorizontalOptions="End"
                                               FontAttributes="Bold"/>
                                        <ProgressBar Grid.Row="1" Grid.ColumnSpan="4"
                                                     Progress="{Binding ProgressRatio}"
                                                     ProgressColor="{Binding ProgressColor}"
                                                     BackgroundColor="#E5E7EB"
                                                     HeightRequest="6"
                                                     Margin="0,4,0,0"/>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>