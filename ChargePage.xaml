<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:MoleculeEfficienceTracker"
    xmlns:converters="clr-namespace:MoleculeEfficienceTracker.Converters"
    x:Class="MoleculeEfficienceTracker.ChargePage"
    Title="Charge">
    <ContentPage.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/ModernStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <Color x:Key="MainBgColor">#F0F4F8</Color>
        </ResourceDictionary>
    </ContentPage.Resources>
    <ContentPage.Background>
        <SolidColorBrush Color="{StaticResource MainBgColor}"/>
    </ContentPage.Background>

    <ScrollView>
        <VerticalStackLayout Style="{StaticResource PageRootLayoutStyle}"
                             BackgroundColor="{StaticResource MainBgColor}">
            <Label Text="ðŸ“Š Charge moyenne"
                   Style="{StaticResource CompactHeaderStyle}"/>

            <!-- Section 24h -->
            <Frame Style="{StaticResource CardFrameStyle}">
                <VerticalStackLayout Spacing="6">
                    <Label Text="ðŸ•’ 24h"
                           FontAttributes="Bold"
                           FontSize="18"
                           TextColor="#2D3748"/>
                    <CollectionView x:Name="StatsCollection1d"
                                    ItemsSource="{Binding Stats1d}"
                                    SelectionMode="None"
                                    HeightRequest="220">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="12"
                                       Padding="8"
                                       Margin="0,4"
                                       HasShadow="False"
                                       BackgroundColor="#FFFFFF">
                                    <VerticalStackLayout Spacing="4">
                                        <Grid ColumnDefinitions="Auto,2*,Auto,Auto,Auto"
                                              ColumnSpacing="8">
                                            <Label Grid.Column="0"
                                                   Text="{Binding Icon}"
                                                   FontSize="16"/>
                                            <Label Grid.Column="1"
                                                   Text="{Binding MoleculeName}"
                                                   FontAttributes="Bold"/>
                                            <Label Grid.Column="2"
                                                   Text="{Binding AvgDose, StringFormat='{}{0:F1} mg'}"
                                                   FontAttributes="Bold"/>
                                            <Label Grid.Column="3"
                                                   Text="{Binding AvgCount, StringFormat='{}{0:F1} prises'}"/>
                                            <Label Grid.Column="4"
                                                   Text="{Binding VariationText}"
                                                   FontAttributes="Bold"
                                                   TextColor="{Binding VariationPercent, Converter={StaticResource VariationColorConverter}}"/>
                                        </Grid>
                                        <ProgressBar Progress="{Binding VariationPercent, Converter={StaticResource VariationProgressConverter}}"
                                                     ProgressColor="{Binding VariationPercent, Converter={StaticResource VariationColorConverter}}"
                                                     HeightRequest="4"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Section 7 jours -->
            <Frame Style="{StaticResource CardFrameStyle}">
                <VerticalStackLayout Spacing="6">
                    <Label Text="ðŸ“† 7 jours"
                           FontAttributes="Bold"
                           FontSize="18"
                           TextColor="#2D3748"/>
                    <CollectionView x:Name="StatsCollection7d"
                                    ItemsSource="{Binding Stats7d}"
                                    SelectionMode="None"
                                    HeightRequest="220">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="12"
                                       Padding="8"
                                       Margin="0,4"
                                       HasShadow="False"
                                       BackgroundColor="#FFFFFF">
                                    <VerticalStackLayout Spacing="4">
                                        <Grid ColumnDefinitions="Auto,2*,Auto,Auto,Auto"
                                              ColumnSpacing="8">
                                            <Label Grid.Column="0"
                                                   Text="{Binding Icon}"
                                                   FontSize="16"/>
                                            <Label Grid.Column="1"
                                                   Text="{Binding MoleculeName}"
                                                   FontAttributes="Bold"/>
                                            <Label Grid.Column="2"
                                                   Text="{Binding AvgDose, StringFormat='{}{0:F1} mg'}"
                                                   FontAttributes="Bold"/>
                                            <Label Grid.Column="3"
                                                   Text="{Binding AvgCount, StringFormat='{}{0:F1} prises'}"/>
                                            <Label Grid.Column="4"
                                                   Text="{Binding VariationText}"
                                                   FontAttributes="Bold"
                                                   TextColor="{Binding VariationPercent, Converter={StaticResource VariationColorConverter}}"/>
                                        </Grid>
                                        <ProgressBar Progress="{Binding VariationPercent, Converter={StaticResource VariationProgressConverter}}"
                                                     ProgressColor="{Binding VariationPercent, Converter={StaticResource VariationColorConverter}}"
                                                     HeightRequest="4"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Section 30 jours -->
            <Frame Style="{StaticResource CardFrameStyle}">
                <VerticalStackLayout Spacing="6">
                    <Label Text="ðŸ“… 30 jours"
                           FontAttributes="Bold"
                           FontSize="18"
                           TextColor="#2D3748"/>
                    <CollectionView x:Name="StatsCollection30d"
                                    ItemsSource="{Binding Stats30d}"
                                    SelectionMode="None"
                                    HeightRequest="220">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame CornerRadius="12"
                                       Padding="8"
                                       Margin="0,4"
                                       HasShadow="False"
                                       BackgroundColor="#FFFFFF">
                                    <VerticalStackLayout Spacing="4">
                                        <Grid ColumnDefinitions="Auto,2*,Auto,Auto,Auto"
                                              ColumnSpacing="8">
                                            <Label Grid.Column="0"
                                                   Text="{Binding Icon}"
                                                   FontSize="16"/>
                                            <Label Grid.Column="1"
                                                   Text="{Binding MoleculeName}"
                                                   FontAttributes="Bold"/>
                                            <Label Grid.Column="2"
                                                   Text="{Binding AvgDose, StringFormat='{}{0:F1} mg'}"
                                                   FontAttributes="Bold"/>
                                            <Label Grid.Column="3"
                                                   Text="{Binding AvgCount, StringFormat='{}{0:F1} prises'}"/>
                                            <Label Grid.Column="4"
                                                   Text="{Binding VariationText}"
                                                   FontAttributes="Bold"
                                                   TextColor="{Binding VariationPercent, Converter={StaticResource VariationColorConverter}}"/>
                                        </Grid>
                                        <ProgressBar Progress="{Binding VariationPercent, Converter={StaticResource VariationProgressConverter}}"
                                                     ProgressColor="{Binding VariationPercent, Converter={StaticResource VariationColorConverter}}"
                                                     HeightRequest="4"/>
                                    </VerticalStackLayout>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>